<div class="layout">
  <header>
    <button class="burger" (click)="toggleSidebar()" aria-label="menu">
      ☰
    </button>
    <div class="brand"><span class="logo">⚙️</span> Skynet</div>
    <div class="user">
      <button class="user-btn" (click)="toggleUserMenu($event)">
        <span class="material-icons" aria-hidden="true">account_circle</span>
        <span class="user-name">{{ username() || "Invitado" }}</span>
        <span class="material-icons" aria-hidden="true">expand_more</span>
      </button>
      <div
        class="user-menu"
        *ngIf="userMenuOpen()"
        (click)="$event.stopPropagation()"
      >
        <div class="menu-header">
          Conectado como <b>{{ username() }}</b>
        </div>
        <div class="menu-sub" *ngIf="roles()?.length">
          <span class="role-chip" *ngFor="let r of roles()">{{ r }}</span>
        </div>
        <button class="item" (click)="openChangePassword()">
          <span class="material-icons">lock_reset</span>
          Cambiar contraseña
        </button>
        <button class="item" (click)="refresh()">
          <span class="material-icons">refresh</span>
          Refrescar token
        </button>
        <button class="item danger" (click)="logout($event)">
          <span class="material-icons">logout</span>
          Salir
        </button>
      </div>
    </div>
  </header>
  <div class="body">
    <aside class="side" [class.open]="sidebarOpen()">
      <nav>
        <h4>Gestión</h4>
        <ul>
          <li *ngIf="showGestion()">
            <a routerLink="/app/gestion/gestiones" routerLinkActive="active"
              >Gestiones</a
            >
          </li>
          <li *ngIf="isCliente()">
            <a routerLink="/app/gestion/mi-cliente" routerLinkActive="active"
              >Mis datos de cliente</a
            >
          </li>
        </ul>
        <h4 *ngIf="showAdmin()">Administración</h4>
        <ul *ngIf="showAdmin()">
          <li>
            <a routerLink="/app/gestion/tipos-gestion" routerLinkActive="active"
              >Tipos de Gestión</a
            >
          </li>
          <li>
            <a routerLink="/app/gestion/empleados" routerLinkActive="active"
              >Empleados</a
            >
          </li>
          <li>
            <a
              routerLink="/app/gestion/tipos-empleado"
              routerLinkActive="active"
              >Tipos de Empleado</a
            >
          </li>
          <li>
            <a routerLink="/app/gestion/clientes" routerLinkActive="active"
              >Clientes</a
            >
          </li>
          <li *ngIf="showUsuarios()">
            <a routerLink="/app/seguridad/usuarios" routerLinkActive="active"
              >Usuarios</a
            >
          </li>
          <li *ngIf="showRoles()">
            <a routerLink="/app/seguridad/roles" routerLinkActive="active"
              >Roles</a
            >
          </li>
        </ul>
      </nav>
    </aside>
    <main class="content">
      <router-outlet></router-outlet>
    </main>
  </div>
  <footer>
    Universidad Mariano Galvez, Facultad de Ingeniería en Sistemas — Derechos
    reservados 2025
  </footer>

  <!-- Modal Cambiar Contraseña (reutilizado) -->
  <app-change-password-dialog
    [open]="changePwdOpen()"
    (close)="closeChangePassword()"
    (submit)="submitChangePassword($event)"
  />
</div>
